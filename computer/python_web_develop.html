<!DOCTYPE html>
<html lang="zh">
<head>
          <title>suhen suchen | 酥賢尋找</title>
        <meta charset="utf-8" />
        <link href="http://blog.suhen.org/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="suhen suchen | 酥賢尋找 Full Atom Feed" />
        <link href="http://blog.suhen.org/feeds/computer.atom.xml" type="application/atom+xml" rel="alternate" title="suhen suchen | 酥賢尋找 Categories Atom Feed" />

        <link rel="stylesheet" href="http://blog.suhen.org/theme/css/rdark.css" />
	<link rel="stylesheet" type="text/css" href="http://blog.suhen.org/theme/css/main.css" />
        <link href="http://blog.suhen.org/" type="application/atom+xml" rel="alternate" title="suhen suchen | 酥賢尋找 ATOM Feed" /><!--[if IE]><script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
        <script type="text/javascript">
        var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
        document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
        </script>
        <script type="text/javascript">
        try {
          var pageTracker = _gat._getTracker("UA-38928548-1");
          pageTracker._trackPageview();
        } catch(err) {}
        </script>
	
<!-- Using MathJax, with the delimiters $ -->
<!-- Conflict with pygments for the .mo and .mi -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
  "HTML-CSS": {
  styles: {
  ".MathJax .mo, .MathJax .mi": {color: "black ! important"}}
  },
  tex2jax: {inlineMath: [['$','$'], ['\\\\(','\\\\)']],processEscapes: true}
  });
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
</head>



    <meta name="tags" contents="note" />

</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="http://blog.suhen.org/">suhen suchen | 酥賢尋找 <strong></strong></a></h1>
        </header><!-- /#banner -->
        <nav id="menu"><ul>
              <li class="active"><a href="http://blog.suhen.org/category/computer.html">computer</a></li>
              <li><a href="http://blog.suhen.org/category/language.html">language</a></li>
              <li><a href="http://blog.suhen.org/category/misc.html">misc</a></li>
              <li><a href="http://blog.suhen.org/category/mountain.html">mountain</a></li>
              <li><a href="http://blog.suhen.org/category/music.html">music</a></li>
              <li><a href="http://blog.suhen.org/category/nature.html">nature</a></li>
              <li><a href="http://blog.suhen.org/category/read.html">read</a></li>
              <li><a href="http://blog.suhen.org/category/run.html">run</a></li>
              <li><a href="http://blog.suhen.org/category/travel.html">travel</a></li>
        </ul></nav><!-- /#menu -->
<section id="content" class="body">
  <header>
    <h2 class="entry-title">
      <a href="http://blog.suhen.org/computer/python_web_develop.html" rel="bookmark"
         title="Permalink to [Web] Python 開發環境 (nginx + gunicorn + supervisord + Flask)">[Web] Python 開發環境 (nginx +  gunicorn + supervisord + Flask)</a></h2>
 
  </header>
  <footer class="post-info">
    <abbr class="published" title="2014-10-20T10:38:00+08:00">
      一 20 10月 2014
    </abbr>
    <address class="vcard author">
      By           <a class="url fn" href="http://blog.suhen.org/author/moogoo.html">moogoo</a>
    </address>
  </footer><!-- /.post-info -->
  <div class="entry-content">
    <h1>Web Servers</h1>
<p>https://www.digitalocean.com/community/tutorials/a-comparison-of-web-servers-for-python-based-web-applications</p>
<h2>Flask</h2>
<p>hello world:</p>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">hello</span><span class="p">():</span>
    <span class="k">return</span> <span class="s">&quot;Hello world!&quot;</span>

 <span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
     <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>


<h2>gunicorn</h2>
<p>gunicorn 要裝在 virtualenv 環境裡</p>
<div class="highlight"><pre><span class="nv">$ </span>gunicorn -b 0.0.0.0:5000 hello:app
<span class="nv">$ </span>gunicorn --check-config <span class="c"># 如果有錯誤用這個檢查</span>
</pre></div>


<h2>supervisor</h2>
<div class="highlight"><pre><span class="nv">$ </span>pip install supervisor
<span class="nv">$ </span>supervisord -c <span class="o">[</span>xxx.conf<span class="o">]</span> <span class="c"># default: /etc/supervisord.conf</span>
<span class="nv">$ </span>supervisord -n <span class="p">;</span> run in foreground

<span class="nv">$ </span>supervisorctl <span class="p">;</span> 進入 console
&gt; <span class="nb">help</span>

<span class="nv">$ </span>supervisorctl restart myapp
</pre></div>


<p>config file:</p>
<div class="highlight"><pre><span class="c1">;;/etc/supervisord.conf:</span>
<span class="k">[program:myapp]</span>
<span class="na">command</span><span class="o">=</span><span class="s">gunicorn main:app -b 0.0.0.0:5050</span>
<span class="na">directory</span><span class="o">=</span><span class="s">/home/ec2-user/myapp/app</span>
<span class="na">autostart</span><span class="o">=</span><span class="s">true</span>
<span class="na">autorestart</span><span class="o">=</span><span class="s">true</span>
<span class="na">redirect_stderr</span><span class="o">=</span><span class="s">True</span>

<span class="k">[unix_http_server]</span>
<span class="na">file</span><span class="o">=</span><span class="s">/tmp/supervisor.sock   ; (the path to the socket file)</span>
<span class="c1">;chmod=0700                 ; socket file mode (default 0700)</span>
<span class="c1">;chown=nobody:nogroup       ; socket file uid:gid owner</span>
<span class="c1">;username=user              ; (default is no username (open server))</span>
<span class="c1">;password=123               ; (default is no password (open server))</span>

<span class="k">[supervisord]</span>
<span class="na">logfile</span> <span class="o">=</span> <span class="s">/tmp/supervisord.log</span>
<span class="na">logfile_maxbytes</span> <span class="o">=</span> <span class="s">50MB</span>
<span class="na">logfile_backups</span><span class="o">=</span><span class="s">10</span>
<span class="na">loglevel</span> <span class="o">=</span> <span class="s">info</span>
<span class="na">pidfile</span> <span class="o">=</span> <span class="s">/tmp/supervisord.pid</span>
<span class="na">nodaemon</span> <span class="o">=</span> <span class="s">false</span>
<span class="na">minfds</span> <span class="o">=</span> <span class="s">1024</span>
<span class="na">minprocs</span> <span class="o">=</span> <span class="s">200</span>
<span class="c1">;umask = 022</span>
<span class="c1">;user = chrism</span>
<span class="na">identifier</span> <span class="o">=</span> <span class="s">supervisor</span>
<span class="na">directory</span> <span class="o">=</span> <span class="s">/tmp</span>
<span class="na">nocleanup</span> <span class="o">=</span> <span class="s">true</span>
<span class="na">childlogdir</span> <span class="o">=</span> <span class="s">/tmp</span>
<span class="na">strip_ansi</span> <span class="o">=</span> <span class="s">false</span>
<span class="na">environment</span> <span class="o">=</span> <span class="s">KEY1=&quot;value1&quot;,KEY2=&quot;value2&quot;</span>

<span class="k">[supervisorctl]</span>
<span class="na">serverurl</span> <span class="o">=</span> <span class="s">unix:///tmp/supervisor.sock</span>

<span class="k">[rpcinterface:supervisor]</span>
<span class="na">supervisor.rpcinterface_factory</span> <span class="o">=</span> <span class="s">supervisor.rpcinterface:make_main_rpcinterface</span>
</pre></div>
  </div><!-- /.entry-content -->
</section>
        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>,
                which takes great advantage of <a href="http://python.org">Python</a>.
                Modified by suhen.
                </address><!-- /#about -->
        </footer><!-- /#contentinfo -->
</body>
</html>